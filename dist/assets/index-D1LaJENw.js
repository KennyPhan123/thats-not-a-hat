var $=Object.defineProperty;var Y=(t,e,s)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var l=(t,e,s)=>Y(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const W="/cards/items/",S="/cards/backs/";function U(){const t=[];for(let e=1;e<=110;e++){const s=String(e).padStart(3,"0");t.push({id:`card_${s}`,front:`${W}card_${s}.png`,back:e<=55?`${S}back_black.png`:`${S}back_white.png`})}return t}function X(t){const e=[...t];for(let s=e.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[e[s],e[n]]=[e[n],e[s]]}return e}function A(t=4){const e="ABCDEFGHJKLMNPQRSTUVWXYZ";let s="";for(let n=0;n<t;n++)s+=e[Math.floor(Math.random()*e.length)];return s}function G(t,e,s,n){const r=[],i=s/2,d=n/2,u=Math.min(s*.38,350),m=Math.min(n*.35,280),y=Math.PI/2;for(let h=0;h<t;h++){const c=(h+e)%t,g=y+h*2*Math.PI/t;r[c]={x:i+u*Math.cos(g),y:d+m*Math.sin(g),isCurrentPlayer:c===e}}return r}class q{constructor(){this.reset()}reset(){this.roomCode="",this.players=[],this.currentPlayerId=null,this.deck=[],this.isHost=!1,this.gameStarted=!1}initDeck(){const e=U();this.deck=X(e)}addPlayer(e){return this.players.length<8?(this.players.push({id:e.id,name:e.name,cards:[null,null],penalties:0}),!0):!1}removePlayer(e){this.players=this.players.filter(s=>s.id!==e)}getPlayer(e){return this.players.find(s=>s.id===e)}getCurrentPlayer(){return this.getPlayer(this.currentPlayerId)}drawCard(e){if(this.deck.length===0)return null;const s=this.getPlayer(e);if(!s)return null;const n=s.cards.findIndex(i=>i===null);if(n===-1)return null;const r=this.deck.pop();return r.isFlipped=!1,s.cards[n]=r,{card:r,slotIndex:n}}flipCard(e,s){const n=this.getPlayer(e);return!n||!n.cards[s]?!1:(n.cards[s].isFlipped=!n.cards[s].isFlipped,!0)}swapCards(e){const s=this.getPlayer(e);return s?([s.cards[0],s.cards[1]]=[s.cards[1],s.cards[0]],!0):!1}transferCard(e,s,n,r){const i=this.getPlayer(e),d=this.getPlayer(n);return!i||!d||!i.cards[s]||d.cards[r]!==null?!1:(d.cards[r]=i.cards[s],i.cards[s]=null,!0)}discardCard(e,s){const n=this.getPlayer(e);return!n||!n.cards[s]?!1:(n.cards[s]=null,n.penalties++,{penalties:n.penalties,gameOver:n.penalties>=3})}checkGameOver(){const e=this.players.find(s=>s.penalties>=3);return e||null}toJSON(){return{roomCode:this.roomCode,players:this.players,deck:this.deck,gameStarted:this.gameStarted}}fromJSON(e){this.roomCode=e.roomCode,this.players=e.players,this.deck=e.deck,this.gameStarted=e.gameStarted}}function J(t,e=!1){const s=document.createElement("div");s.className=`card${e?" large":""}${t.isFlipped?" flipped":""}`,s.dataset.cardId=t.id,s.draggable=!1;const n=document.createElement("div");n.className="card-inner";const r=document.createElement("div");r.className="card-face card-front",r.style.backgroundImage=`url(${t.front})`;const i=document.createElement("div");return i.className="card-face card-back",i.style.backgroundImage=`url(${t.back})`,n.appendChild(r),n.appendChild(i),s.appendChild(n),s}let E=0;function j(t,e){const s=n=>{const r=Date.now();r-E<300?(n.preventDefault(),e(),E=0):E=r};t.addEventListener("touchend",s),t.addEventListener("dblclick",n=>{n.preventDefault(),e()})}function Q(t,e,s){e.innerHTML="";const n=G(t.players.length,t.players.findIndex(r=>r.id===t.currentPlayerId),window.innerWidth,window.innerHeight);t.players.forEach((r,i)=>{const d=n[i],u=z(r,d,t.currentPlayerId,s);e.appendChild(u)})}function z(t,e,s,n){const r=t.id===s,i=document.createElement("div");i.className=`player-slot${r?" current-player":""}`,i.dataset.playerId=t.id,i.style.left=`${e.x}px`,i.style.top=`${e.y}px`;const d=document.createElement("div");d.className="player-info";const u=document.createElement("span");if(u.className="player-name",u.textContent=t.name,d.appendChild(u),t.penalties>0){const h=document.createElement("span");h.className="player-penalty",h.textContent=`−${t.penalties}`,d.appendChild(h)}i.appendChild(d);const m=document.createElement("div");m.className="player-cards";const y=n.slotCount||t.cards.length;for(let h=0;h<y;h++){const c=document.createElement("div");if(c.className="card-slot",c.dataset.slotIndex=h,t.cards[h]){c.classList.add("occupied");const g=J(t.cards[h],r);r&&n.onFlip&&j(g,()=>{n.onFlip(t.id,h)}),c.appendChild(g)}m.appendChild(c)}return i.appendChild(m),i}class V{constructor(e){this.container=e.container,this.onDragStart=e.onDragStart||(()=>{}),this.onDragMove=e.onDragMove||(()=>{}),this.onDragEnd=e.onDragEnd||(()=>{}),this.onDrop=e.onDrop||(()=>{}),this.isDragging=!1,this.dragElement=null,this.dragClone=null,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.dragData=null,this.hasMoved=!1,this.dragThreshold=10,this.bindEvents()}bindEvents(){this.container.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.container.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this))}getCardElement(e){return e.closest(".card")}handleMouseDown(e){const s=this.getCardElement(e.target);s&&(Date.now()-(s.lastTapTime||0)<300||(this.pendingDrag={card:s,startX:e.clientX,startY:e.clientY}))}handleTouchStart(e){if(e.touches.length!==1)return;const s=e.touches[0],n=this.getCardElement(s.target);n&&(n.touchStartTime=Date.now(),this.touchStartCard=n,this.pendingDrag={card:n,startX:s.clientX,startY:s.clientY})}startDrag(e,s,n){const r=e.getBoundingClientRect();this.isDragging=!0,this.dragElement=e,this.startX=s,this.startY=n,this.offsetX=s-r.left,this.offsetY=n-r.top,this.dragClone=e.cloneNode(!0),this.dragClone.className=e.className+" dragging",this.dragClone.style.position="fixed",this.dragClone.style.left=`${r.left}px`,this.dragClone.style.top=`${r.top}px`,this.dragClone.style.width=`${r.width}px`,this.dragClone.style.height=`${r.height}px`,this.dragClone.style.zIndex="9999",document.body.appendChild(this.dragClone),e.style.opacity="0.3";const i=e.closest(".card-slot"),d=e.closest(".player-slot");i&&d&&(this.dragData={cardId:e.dataset.cardId,fromPlayerId:d.dataset.playerId,fromSlot:parseInt(i.dataset.slotIndex)}),this.onDragStart(this.dragData),this.hasMoved=!1}handleMouseMove(e){if(this.pendingDrag&&!this.isDragging){const s=Math.abs(e.clientX-this.pendingDrag.startX),n=Math.abs(e.clientY-this.pendingDrag.startY);(s>this.dragThreshold||n>this.dragThreshold)&&(this.startDrag(this.pendingDrag.card,this.pendingDrag.startX,this.pendingDrag.startY),this.hasMoved=!0,this.pendingDrag=null);return}this.isDragging&&this.moveDrag(e.clientX,e.clientY)}handleTouchMove(e){if(e.touches.length!==1)return;const s=e.touches[0];if(this.pendingDrag&&!this.isDragging){const n=Math.abs(s.clientX-this.pendingDrag.startX),r=Math.abs(s.clientY-this.pendingDrag.startY);(n>this.dragThreshold||r>this.dragThreshold)&&(e.preventDefault(),this.startDrag(this.pendingDrag.card,this.pendingDrag.startX,this.pendingDrag.startY),this.hasMoved=!0,this.pendingDrag=null);return}this.isDragging&&(e.preventDefault(),this.moveDrag(s.clientX,s.clientY))}moveDrag(e,s){if(!this.dragClone)return;const n=Math.abs(e-this.startX),r=Math.abs(s-this.startY);(n>this.dragThreshold||r>this.dragThreshold)&&(this.hasMoved=!0),this.dragClone.style.left=`${e-this.offsetX}px`,this.dragClone.style.top=`${s-this.offsetY}px`,this.updateDropTargets(e,s),this.onDragMove(e,s,this.dragData)}updateDropTargets(e,s){document.querySelectorAll(".drag-over").forEach(r=>{r.classList.remove("drag-over")}),this.dragClone&&(this.dragClone.style.pointerEvents="none");const n=document.elementsFromPoint(e,s);this.dragClone&&(this.dragClone.style.pointerEvents="");for(const r of n){if(r.classList.contains("penalty-zone")){r.classList.add("drag-over");break}if(r.classList.contains("player-slot")){r.querySelector(".card-slot:not(.occupied)")&&r.classList.add("drag-over");break}}}handleMouseUp(e){this.pendingDrag&&(this.pendingDrag=null),this.isDragging&&this.endDrag(e.clientX,e.clientY)}handleTouchEnd(e){if(this.pendingDrag&&(this.pendingDrag=null),!this.isDragging)return;const s=e.changedTouches[0];this.endDrag(s.clientX,s.clientY)}endDrag(e,s){if(this.isDragging){if(this.dragElement&&(this.dragElement.style.opacity=""),this.dragClone&&(this.dragClone.remove(),this.dragClone=null),document.querySelectorAll(".drag-over").forEach(n=>{n.classList.remove("drag-over")}),this.hasMoved){const n=document.elementsFromPoint(e,s);let r=null;for(const i of n){if(i.classList.contains("penalty-zone")){r={type:"penalty"};break}if(i.classList.contains("player-slot")){const d=i.querySelector(".card-slot:not(.occupied)");d&&(r={type:"player",playerId:i.dataset.playerId,slotIndex:parseInt(d.dataset.slotIndex),isEmpty:!0});break}}this.onDrop(this.dragData,r)}this.onDragEnd(),this.isDragging=!1,this.dragElement=null,this.dragData=null,this.hasMoved=!1}}destroy(){}}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var O=class extends Event{constructor(e,s){super("error",s);l(this,"message");l(this,"error");this.message=e.message,this.error=e}},H=class extends Event{constructor(e=1e3,s="",n){super("close",n);l(this,"code");l(this,"reason");l(this,"wasClean",!0);this.code=e,this.reason=s}};const C={Event,ErrorEvent:O,CloseEvent:H};function K(t,e){if(!t)throw new Error(e)}function Z(t){return new t.constructor(t.type,t)}function ee(t){return"data"in t?new MessageEvent(t.type,t):"code"in t||"reason"in t?new H(t.code||1999,t.reason||"unknown reason",t):"error"in t?new O(t.error,t):new Event(t.type,t)}var P;const v=typeof process<"u"&&typeof((P=process.versions)==null?void 0:P.node)<"u"&&typeof document>"u"?ee:Z,f={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let L=!1;var te=class _ extends EventTarget{constructor(s,n,r={}){super();l(this,"_ws");l(this,"_retryCount",-1);l(this,"_uptimeTimeout");l(this,"_connectTimeout");l(this,"_shouldReconnect",!0);l(this,"_connectLock",!1);l(this,"_binaryType","blob");l(this,"_closeCalled",!1);l(this,"_messageQueue",[]);l(this,"_debugLogger",console.log.bind(console));l(this,"_url");l(this,"_protocols");l(this,"_options");l(this,"onclose",null);l(this,"onerror",null);l(this,"onmessage",null);l(this,"onopen",null);l(this,"_handleOpen",s=>{this._debug("open event");const{minUptime:n=f.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),K(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{var i;(i=this._ws)==null||i.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(s),this.dispatchEvent(v(s))});l(this,"_handleMessage",s=>{this._debug("message event"),this.onmessage&&this.onmessage(s),this.dispatchEvent(v(s))});l(this,"_handleError",s=>{this._debug("error event",s.message),this._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(s),this._debug("exec error listeners"),this.dispatchEvent(v(s)),this._connect()});l(this,"_handleClose",s=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(s),this.dispatchEvent(v(s))});this._url=s,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return _.CONNECTING}get OPEN(){return _.OPEN}get CLOSING(){return _.CLOSING}get CLOSED(){return _.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(s){this._binaryType=s,this._ws&&(this._ws.binaryType=s)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((s,n)=>(typeof n=="string"?s+=n.length:n instanceof Blob?s+=n.size:s+=n.byteLength,s),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?_.CLOSED:_.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(s=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(s,n)}reconnect(s,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(s,n),this._connect())}send(s){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",s),this._ws.send(s);else{const{maxEnqueuedMessages:n=f.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",s),this._messageQueue.push(s))}}_debug(...s){this._options.debug&&this._debugLogger("RWS>",...s)}_getNextDelay(){const{reconnectionDelayGrowFactor:s=f.reconnectionDelayGrowFactor,minReconnectionDelay:n=f.minReconnectionDelay,maxReconnectionDelay:r=f.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*s**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(s=>{setTimeout(s,this._getNextDelay())})}_getNextProtocols(s){if(!s)return Promise.resolve(null);if(typeof s=="string"||Array.isArray(s))return Promise.resolve(s);if(typeof s=="function"){const n=s();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(s){if(typeof s=="string")return Promise.resolve(s);if(typeof s=="function"){const n=s();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:s=f.maxRetries,connectionTimeout:n=f.connectionTimeout}=this._options;if(this._retryCount>=s){this._debug("max retries reached",this._retryCount,">=",s);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!L&&(console.error(`‼️ No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),L=!0);const d=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new d(r,i):new d(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new C.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new C.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(s=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(s,n),this._handleClose(new C.CloseEvent(s,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const se=t=>t[1]!==null&&t[1]!==void 0;function ne(){if(crypto!=null&&crypto.randomUUID)return crypto.randomUUID();let t=Date.now(),e=(performance==null?void 0:performance.now)&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let n=Math.random()*16;return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(e+n)%16|0,e=Math.floor(e/16)),(s==="x"?n:n&3|8).toString(16)})}function F(t,e,s={}){const{host:n,path:r,protocol:i,room:d,party:u,basePath:m,prefix:y,query:h}=t;let c=n.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),r!=null&&r.startsWith("/"))throw new Error("path must not start with a slash");const g=u??"main",b=r?`/${r}`:"",k=i||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?e:`${e}s`),I=`${k}://${c}/${m||`${y||"parties"}/${g}/${d}`}${b}`,w=(B={})=>`${I}?${new URLSearchParams([...Object.entries(s),...Object.entries(B).filter(se)])}`,R=typeof h=="function"?async()=>w(await h()):w(h);return{host:c,path:b,room:d,name:g,protocol:k,partyUrl:I,urlProvider:R}}var re=class extends te{constructor(e){var n,r;const s=x(e);super(s.urlProvider,s.protocols,s.socketOptions);l(this,"_pk");l(this,"_pkurl");l(this,"name");l(this,"room");l(this,"host");l(this,"path");this.partySocketOptions=e,this.setWSProperties(s),e.disableNameValidation||((n=e.party)!=null&&n.includes("/")&&console.warn(`PartySocket: party name "${e.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),(r=e.room)!=null&&r.includes("/")&&console.warn(`PartySocket: room name "${e.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(e){const s=x({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=s.urlProvider,this._protocols=s.protocols,this._options=s.socketOptions,this.setWSProperties(s)}setWSProperties(e){const{_pk:s,_pkurl:n,name:r,room:i,host:d,path:u}=e;this._pk=s,this._pkurl=n,this.name=r,this.room=i,this.host=d,this.path=u}reconnect(e,s){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,s)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,s){const n=F(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,s)}};function x(t){const{id:e,host:s,path:n,party:r,room:i,protocol:d,query:u,protocols:m,...y}=t,h=e||ne(),c=F(t,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:m,socketOptions:y,urlProvider:c.urlProvider}}const oe="tnah.kennyphan123.partykit.dev",o={socket:null,playerId:null,playerName:"",roomCode:"",isHost:!1,gameState:new q,dragHandler:null,discardHistory:[],hardMode:!1,slotCount:2},a={lobby:document.getElementById("lobby"),game:document.getElementById("game"),mainMenu:document.getElementById("mainMenu"),showCreate:document.getElementById("showCreate"),showJoin:document.getElementById("showJoin"),createForm:document.getElementById("createForm"),joinForm:document.getElementById("joinForm"),createName:document.getElementById("createName"),joinName:document.getElementById("joinName"),roomCode:document.getElementById("roomCode"),createRoom:document.getElementById("createRoom"),joinRoom:document.getElementById("joinRoom"),roomInfo:document.getElementById("roomInfo"),displayRoomCode:document.getElementById("displayRoomCode"),playerCount:document.getElementById("playerCount"),playerList:document.getElementById("playerList"),startGame:document.getElementById("startGame"),waitingText:document.querySelector(".waiting-text"),gameTable:document.getElementById("gameTable"),deck:document.getElementById("deck"),playersContainer:document.getElementById("playersContainer"),penaltyZone:document.getElementById("penaltyZone"),gameOverModal:document.getElementById("gameOverModal"),gameOverMessage:document.getElementById("gameOverMessage"),playAgain:document.getElementById("playAgain"),hardModeToggle:document.getElementById("hardModeToggle"),hardModeCheckbox:document.getElementById("hardModeCheckbox")};function ie(){ae(),me(),window.addEventListener("resize",()=>{o.gameState.gameStarted&&p()})}function ae(){var t,e,s,n;a.showCreate.addEventListener("click",()=>{a.mainMenu.classList.add("hidden"),a.createForm.classList.remove("hidden")}),a.showJoin.addEventListener("click",()=>{a.mainMenu.classList.add("hidden"),a.joinForm.classList.remove("hidden")}),a.createRoom.addEventListener("click",()=>{const r=a.createName.value.trim();if(!r){alert("Please enter your name");return}o.playerName=r,o.roomCode=A(4),o.isHost=!0,M()}),a.joinRoom.addEventListener("click",()=>{const r=a.joinName.value.trim(),i=a.roomCode.value.trim().toUpperCase();if(!r){alert("Please enter your name");return}if(!i||i.length!==4){alert("Please enter 4-letter room code");return}o.playerName=r,o.roomCode=i,o.isHost=!1,M()}),a.startGame.addEventListener("click",()=>{o.socket&&o.isHost&&o.socket.send(JSON.stringify({type:"start"}))}),(t=document.getElementById("backFromCreate"))==null||t.addEventListener("click",()=>{a.createForm.classList.add("hidden"),a.mainMenu.classList.remove("hidden")}),(e=document.getElementById("backFromJoin"))==null||e.addEventListener("click",()=>{a.joinForm.classList.add("hidden"),a.mainMenu.classList.remove("hidden")}),(s=document.getElementById("copyCodeBtn"))==null||s.addEventListener("click",de),(n=a.hardModeCheckbox)==null||n.addEventListener("change",r=>{o.socket&&o.isHost&&o.socket.send(JSON.stringify({type:"toggleHardMode",enabled:r.target.checked}))})}function de(){const t=a.displayRoomCode.textContent,e=document.getElementById("copyCodeBtn");navigator.clipboard.writeText(t).then(()=>{e.textContent="Copied!",setTimeout(()=>{e.textContent="Tap to Copy"},2e3)}).catch(()=>{const s=document.createElement("textarea");s.value=t,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),e.textContent="Copied!",setTimeout(()=>{e.textContent="Tap to Copy"},2e3)})}function M(){o.socket=new re({host:oe,room:o.roomCode}),o.socket.addEventListener("open",()=>{o.playerId=o.socket.id,o.socket.send(JSON.stringify({type:"join",name:o.playerName})),le(),o.pingInterval&&clearInterval(o.pingInterval),o.pingInterval=setInterval(()=>{o.socket&&o.socket.readyState===WebSocket.OPEN&&o.socket.send(JSON.stringify({type:"ping"}))},3e4)}),o.socket.addEventListener("message",t=>{ce(JSON.parse(t.data))}),o.socket.addEventListener("error",t=>{console.error("Connection error:",t)}),o.socket.addEventListener("close",()=>{o.pingInterval&&(clearInterval(o.pingInterval),o.pingInterval=null),o.gameState.gameStarted&&console.log("Connection lost, attempting to reconnect...")})}function le(){a.displayRoomCode.textContent=o.roomCode,a.roomInfo.classList.remove("hidden"),a.mainMenu.classList.add("hidden"),a.createForm.classList.add("hidden"),a.joinForm.classList.add("hidden")}function D(){const t=o.gameState.players;a.playerCount.textContent=t.length,a.playerList.innerHTML=t.map(e=>`<span class="player-tag${e.id===o.gameState.hostId?" host":""}">${e.name}${e.id===o.gameState.hostId?" (Host)":""}</span>`).join(""),o.isHost&&t.length>=2?(a.startGame.classList.remove("hidden"),a.hardModeToggle.classList.remove("hidden"),a.waitingText.classList.add("hidden")):o.isHost?a.hardModeToggle.classList.remove("hidden"):o.isHost||(a.waitingText.classList.remove("hidden"),a.hardModeToggle.classList.add("hidden"))}function ce(t){switch(console.log("Server:",t.type,t),t.type){case"state":o.gameState.players=t.state.players||[],o.gameState.deck=t.state.deck||[],o.gameState.hostId=t.state.hostId,o.gameState.gameStarted=t.state.gameStarted,t.state.gameStarted&&T();break;case"playerJoined":o.gameState.players=t.players,o.gameState.hostId=t.hostId,t.hostId===o.playerId&&(o.isHost=!0),D();break;case"playerLeft":o.gameState.players=t.players,t.hostId===o.playerId&&(o.isHost=!0),D(),o.gameState.gameStarted&&p();break;case"gameStarted":o.gameState.deck=t.deck,o.gameState.players=t.players,o.gameState.gameStarted=!0,o.hardMode=t.hardMode||!1,o.slotCount=t.slotCount||2,T();break;case"cardDrawn":ve(t);break;case"cardFlipped":Ee(t);break;case"cardMoved":o.gameState.players=t.players,p();break;case"cardsSwapped":Ce(t);break;case"cardDiscarded":be(t);break;case"gameReset":o.gameState.deck=t.deck,o.gameState.players=t.players,o.discardHistory=t.discardHistory||[],o.hardMode=t.hardMode||!1,o.slotCount=t.slotCount||2,a.gameOverModal.classList.add("hidden"),p();break;case"hardModeChanged":o.hardMode=t.hardMode,o.slotCount=t.slotCount,o.gameState.players=t.players,a.hardModeCheckbox&&(a.hardModeCheckbox.checked=t.hardMode);break;case"error":alert(t.message);break}}function T(){a.lobby.classList.remove("active"),a.game.classList.add("active"),o.gameState.currentPlayerId=o.playerId,he(),p()}function he(){o.dragHandler=new V({container:a.gameTable,onDrop:_e})}function p(){ue(),Q(o.gameState,a.playersContainer,{onFlip:fe,slotCount:o.slotCount})}function ue(){const t=a.deck,e=t.querySelector(".deck-cards"),s=t.querySelector(".deck-count");e.innerHTML="";const n=o.gameState.deck;if(n.length>0){const r=Math.min(n.length,5);for(let i=r-1;i>=0;i--){const d=document.createElement("div");d.className="deck-card";const u=n.length-1-i;n[u]&&(d.style.backgroundImage=`url(${n[u].front})`),d.style.top=`${-i*2}px`,d.style.left=`${i*1}px`,d.style.zIndex=r-i,e.appendChild(d)}}s.textContent=n.length,t.onclick=()=>{o.socket&&n.length>0&&o.socket.send(JSON.stringify({type:"draw"}))},t.style.display=n.length>0?"":"none"}function me(){var e;(e=a.playAgain)==null||e.addEventListener("click",()=>{o.socket&&o.socket.send(JSON.stringify({type:"reset"}))}),ge();const t=document.getElementById("fullscreenBtn");t==null||t.addEventListener("click",pe)}function pe(){if(!document.fullscreenElement&&!document.webkitFullscreenElement){const t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}else document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function ge(){a.penaltyZone.addEventListener("click",t=>{t.target.closest(".card")||ye()})}function ye(){let t=document.getElementById("discardHistoryModal");if(t){t.classList.toggle("hidden"),t.classList.contains("hidden")||N();return}t=document.createElement("div"),t.id="discardHistoryModal",t.className="modal",t.innerHTML=`
        <div class="modal-content discard-history-modal">
            <h2>Discard History</h2>
            <div id="discardHistoryList" class="discard-history-list"></div>
            <button id="closeDiscardHistory" class="btn btn-secondary">Close</button>
        </div>
    `,document.body.appendChild(t),document.getElementById("closeDiscardHistory").addEventListener("click",()=>{t.classList.add("hidden")}),t.addEventListener("click",e=>{e.target===t&&t.classList.add("hidden")}),N()}function N(){const t=document.getElementById("discardHistoryList");if(t){if(o.discardHistory.length===0){t.innerHTML='<p class="no-discards">No cards discarded yet</p>';return}t.innerHTML=o.discardHistory.map((e,s)=>`
        <div class="discard-item">
            <div class="discard-card" style="background-image: url(${e.card.front})"></div>
            <span class="discard-player">${e.playerName}</span>
        </div>
    `).join("")}}function fe(t,e){t===o.playerId&&o.socket&&o.socket.send(JSON.stringify({type:"flip",slotIndex:e}))}function _e(t,e){!t||!e||(e.type==="penalty"?t.fromPlayerId===o.playerId&&o.socket&&o.socket.send(JSON.stringify({type:"discard",playerId:t.fromPlayerId,slotIndex:t.fromSlot})):e.type==="player"&&(e.playerId===t.fromPlayerId?t.fromSlot!==e.slotIndex&&o.socket&&o.socket.send(JSON.stringify({type:"swapCards",playerId:t.fromPlayerId})):e.playerId===o.playerId&&e.isEmpty?o.socket&&o.socket.send(JSON.stringify({type:"moveCard",fromPlayerId:t.fromPlayerId,fromSlot:t.fromSlot,toPlayerId:e.playerId,toSlot:e.slotIndex})):t.fromPlayerId===o.playerId&&e.isEmpty&&o.socket&&o.socket.send(JSON.stringify({type:"moveCard",fromPlayerId:t.fromPlayerId,fromSlot:t.fromSlot,toPlayerId:e.playerId,toSlot:e.slotIndex}))))}function ve(t){o.gameState.deck.pop(),t.players&&(o.gameState.players=t.players),p()}function Ee(t){const e=o.gameState.players.find(s=>s.id===t.playerId);e&&e.cards[t.slotIndex]&&(e.cards[t.slotIndex].isFlipped=t.isFlipped),p()}function Ce(t){const e=o.gameState.players.find(s=>s.id===t.playerId);e&&(e.cards=t.cards),p()}function be(t){t.players&&(o.gameState.players=t.players),t.discardHistory&&(o.discardHistory=t.discardHistory),p(),t.gameOver&&ke(t.loserName)}function ke(t){a.gameOverMessage.textContent=`${t} got 3 penalties and lost!`,a.gameOverModal.classList.remove("hidden")}ie();
