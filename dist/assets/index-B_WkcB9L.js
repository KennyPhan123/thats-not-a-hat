var $=Object.defineProperty;var W=(e,t,s)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var d=(e,t,s)=>W(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const U="/cards/items/",S="/cards/backs/";function A(){const e=[];for(let t=1;t<=110;t++){const s=String(t).padStart(3,"0");e.push({id:`card_${s}`,front:`${U}card_${s}.png`,back:t<=55?`${S}back_black.png`:`${S}back_white.png`})}return e}function G(e){const t=[...e];for(let s=t.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[t[s],t[n]]=[t[n],t[s]]}return t}function q(e=4){const t="ABCDEFGHJKLMNPQRSTUVWXYZ";let s="";for(let n=0;n<e;n++)s+=t[Math.floor(Math.random()*t.length)];return s}function J(e,t,s,n){const r=[],i=s/2,l=n/2,u=Math.min(s*.38,350),m=Math.min(n*.35,280),y=Math.PI/2;for(let h=0;h<e;h++){const c=(h+t)%e,g=y+h*2*Math.PI/e;r[c]={x:i+u*Math.cos(g),y:l+m*Math.sin(g),isCurrentPlayer:c===t}}return r}class j{constructor(){this.reset()}reset(){this.roomCode="",this.players=[],this.currentPlayerId=null,this.deck=[],this.isHost=!1,this.gameStarted=!1}initDeck(){const t=A();this.deck=G(t)}addPlayer(t){return this.players.length<8?(this.players.push({id:t.id,name:t.name,cards:[null,null],penalties:0}),!0):!1}removePlayer(t){this.players=this.players.filter(s=>s.id!==t)}getPlayer(t){return this.players.find(s=>s.id===t)}getCurrentPlayer(){return this.getPlayer(this.currentPlayerId)}drawCard(t){if(this.deck.length===0)return null;const s=this.getPlayer(t);if(!s)return null;const n=s.cards.findIndex(i=>i===null);if(n===-1)return null;const r=this.deck.pop();return r.isFlipped=!1,s.cards[n]=r,{card:r,slotIndex:n}}flipCard(t,s){const n=this.getPlayer(t);return!n||!n.cards[s]?!1:(n.cards[s].isFlipped=!n.cards[s].isFlipped,!0)}swapCards(t){const s=this.getPlayer(t);return s?([s.cards[0],s.cards[1]]=[s.cards[1],s.cards[0]],!0):!1}transferCard(t,s,n,r){const i=this.getPlayer(t),l=this.getPlayer(n);return!i||!l||!i.cards[s]||l.cards[r]!==null?!1:(l.cards[r]=i.cards[s],i.cards[s]=null,!0)}discardCard(t,s){const n=this.getPlayer(t);return!n||!n.cards[s]?!1:(n.cards[s]=null,n.penalties++,{penalties:n.penalties,gameOver:n.penalties>=3})}checkGameOver(){const t=this.players.find(s=>s.penalties>=3);return t||null}toJSON(){return{roomCode:this.roomCode,players:this.players,deck:this.deck,gameStarted:this.gameStarted}}fromJSON(t){this.roomCode=t.roomCode,this.players=t.players,this.deck=t.deck,this.gameStarted=t.gameStarted}}function Y(e,t=!1){const s=document.createElement("div");s.className=`card${t?" large":""}${e.isFlipped?" flipped":""}`,s.dataset.cardId=e.id,s.draggable=!1;const n=document.createElement("div");n.className="card-inner";const r=document.createElement("div");r.className="card-face card-front",r.style.backgroundImage=`url(${e.front})`;const i=document.createElement("div");return i.className="card-face card-back",i.style.backgroundImage=`url(${e.back})`,n.appendChild(r),n.appendChild(i),s.appendChild(n),s}let E=0;function X(e,t){const s=n=>{const r=Date.now();r-E<300?(n.preventDefault(),t(),E=0):E=r};e.addEventListener("touchend",s),e.addEventListener("dblclick",n=>{n.preventDefault(),t()})}function Q(e,t,s){t.innerHTML="";const n=J(e.players.length,e.players.findIndex(r=>r.id===e.currentPlayerId),window.innerWidth,window.innerHeight);e.players.forEach((r,i)=>{const l=n[i],u=z(r,l,e.currentPlayerId,s);t.appendChild(u)})}function z(e,t,s,n){const r=e.id===s,i=document.createElement("div");i.className=`player-slot${r?" current-player":""}`,i.dataset.playerId=e.id,i.style.left=`${t.x}px`,i.style.top=`${t.y}px`;const l=document.createElement("div");l.className="player-info";const u=document.createElement("span");if(u.className="player-name",u.textContent=e.name,l.appendChild(u),e.penalties>0){const h=document.createElement("span");h.className="player-penalty",h.textContent=`−${e.penalties}`,l.appendChild(h)}i.appendChild(l);const m=document.createElement("div");m.className="player-cards";const y=n.slotCount||e.cards.length;for(let h=0;h<y;h++){const c=document.createElement("div");if(c.className="card-slot",c.dataset.slotIndex=h,e.cards[h]){c.classList.add("occupied");const g=Y(e.cards[h],r);r&&n.onFlip&&X(g,()=>{n.onFlip(e.id,h)}),c.appendChild(g)}m.appendChild(c)}return i.appendChild(m),i}class V{constructor(t){this.container=t.container,this.onDragStart=t.onDragStart||(()=>{}),this.onDragMove=t.onDragMove||(()=>{}),this.onDragEnd=t.onDragEnd||(()=>{}),this.onDrop=t.onDrop||(()=>{}),this.isDragging=!1,this.dragElement=null,this.dragClone=null,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.dragData=null,this.bindEvents()}bindEvents(){this.container.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.container.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this))}getCardElement(t){return t.closest(".card")}handleMouseDown(t){const s=this.getCardElement(t.target);s&&(Date.now()-(s.lastTapTime||0)<300||this.startDrag(s,t.clientX,t.clientY))}handleTouchStart(t){if(t.touches.length!==1)return;const s=t.touches[0],n=this.getCardElement(s.target);n&&(n.touchStartTime=Date.now(),this.touchStartCard=n,this.dragTimeout=setTimeout(()=>{this.startDrag(n,s.clientX,s.clientY),t.preventDefault()},150))}startDrag(t,s,n){const r=t.getBoundingClientRect();this.isDragging=!0,this.dragElement=t,this.startX=s,this.startY=n,this.offsetX=s-r.left,this.offsetY=n-r.top,this.dragClone=t.cloneNode(!0),this.dragClone.className=t.className+" dragging",this.dragClone.style.position="fixed",this.dragClone.style.left=`${r.left}px`,this.dragClone.style.top=`${r.top}px`,this.dragClone.style.width=`${r.width}px`,this.dragClone.style.height=`${r.height}px`,this.dragClone.style.zIndex="9999",document.body.appendChild(this.dragClone),t.style.opacity="0.3";const i=t.closest(".card-slot"),l=t.closest(".player-slot");i&&l&&(this.dragData={cardId:t.dataset.cardId,fromPlayerId:l.dataset.playerId,fromSlot:parseInt(i.dataset.slotIndex)}),this.onDragStart(this.dragData)}handleMouseMove(t){this.isDragging&&this.moveDrag(t.clientX,t.clientY)}handleTouchMove(t){if(this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null),!this.isDragging||t.touches.length!==1)return;t.preventDefault();const s=t.touches[0];this.moveDrag(s.clientX,s.clientY)}moveDrag(t,s){this.dragClone&&(this.dragClone.style.left=`${t-this.offsetX}px`,this.dragClone.style.top=`${s-this.offsetY}px`,this.updateDropTargets(t,s),this.onDragMove(t,s,this.dragData))}updateDropTargets(t,s){document.querySelectorAll(".drag-over").forEach(r=>{r.classList.remove("drag-over")}),this.dragClone&&(this.dragClone.style.pointerEvents="none");const n=document.elementsFromPoint(t,s);this.dragClone&&(this.dragClone.style.pointerEvents="");for(const r of n){if(r.classList.contains("penalty-zone")){r.classList.add("drag-over");break}if(r.classList.contains("player-slot")){r.querySelector(".card-slot:not(.occupied)")&&r.classList.add("drag-over");break}}}handleMouseUp(t){this.isDragging&&this.endDrag(t.clientX,t.clientY)}handleTouchEnd(t){if(this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null),!this.isDragging)return;const s=t.changedTouches[0];this.endDrag(s.clientX,s.clientY)}endDrag(t,s){if(!this.isDragging)return;this.dragElement&&(this.dragElement.style.opacity=""),this.dragClone&&(this.dragClone.remove(),this.dragClone=null),document.querySelectorAll(".drag-over").forEach(i=>{i.classList.remove("drag-over")});const n=document.elementsFromPoint(t,s);let r=null;for(const i of n){if(i.classList.contains("penalty-zone")){r={type:"penalty"};break}if(i.classList.contains("player-slot")){const l=i.querySelector(".card-slot:not(.occupied)");l&&(r={type:"player",playerId:i.dataset.playerId,slotIndex:parseInt(l.dataset.slotIndex),isEmpty:!0});break}}this.onDrop(this.dragData,r),this.onDragEnd(),this.isDragging=!1,this.dragElement=null,this.dragData=null}destroy(){}}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var O=class extends Event{constructor(t,s){super("error",s);d(this,"message");d(this,"error");this.message=t.message,this.error=t}},H=class extends Event{constructor(t=1e3,s="",n){super("close",n);d(this,"code");d(this,"reason");d(this,"wasClean",!0);this.code=t,this.reason=s}};const C={Event,ErrorEvent:O,CloseEvent:H};function K(e,t){if(!e)throw new Error(t)}function Z(e){return new e.constructor(e.type,e)}function ee(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new H(e.code||1999,e.reason||"unknown reason",e):"error"in e?new O(e.error,e):new Event(e.type,e)}var D;const v=typeof process<"u"&&typeof((D=process.versions)==null?void 0:D.node)<"u"&&typeof document>"u"?ee:Z,f={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let L=!1;var te=class _ extends EventTarget{constructor(s,n,r={}){super();d(this,"_ws");d(this,"_retryCount",-1);d(this,"_uptimeTimeout");d(this,"_connectTimeout");d(this,"_shouldReconnect",!0);d(this,"_connectLock",!1);d(this,"_binaryType","blob");d(this,"_closeCalled",!1);d(this,"_messageQueue",[]);d(this,"_debugLogger",console.log.bind(console));d(this,"_url");d(this,"_protocols");d(this,"_options");d(this,"onclose",null);d(this,"onerror",null);d(this,"onmessage",null);d(this,"onopen",null);d(this,"_handleOpen",s=>{this._debug("open event");const{minUptime:n=f.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),K(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{var i;(i=this._ws)==null||i.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(s),this.dispatchEvent(v(s))});d(this,"_handleMessage",s=>{this._debug("message event"),this.onmessage&&this.onmessage(s),this.dispatchEvent(v(s))});d(this,"_handleError",s=>{this._debug("error event",s.message),this._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(s),this._debug("exec error listeners"),this.dispatchEvent(v(s)),this._connect()});d(this,"_handleClose",s=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(s),this.dispatchEvent(v(s))});this._url=s,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return _.CONNECTING}get OPEN(){return _.OPEN}get CLOSING(){return _.CLOSING}get CLOSED(){return _.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(s){this._binaryType=s,this._ws&&(this._ws.binaryType=s)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((s,n)=>(typeof n=="string"?s+=n.length:n instanceof Blob?s+=n.size:s+=n.byteLength,s),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?_.CLOSED:_.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(s=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(s,n)}reconnect(s,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(s,n),this._connect())}send(s){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",s),this._ws.send(s);else{const{maxEnqueuedMessages:n=f.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",s),this._messageQueue.push(s))}}_debug(...s){this._options.debug&&this._debugLogger("RWS>",...s)}_getNextDelay(){const{reconnectionDelayGrowFactor:s=f.reconnectionDelayGrowFactor,minReconnectionDelay:n=f.minReconnectionDelay,maxReconnectionDelay:r=f.maxReconnectionDelay}=this._options;let i=0;return this._retryCount>0&&(i=n*s**(this._retryCount-1),i>r&&(i=r)),this._debug("next delay",i),i}_wait(){return new Promise(s=>{setTimeout(s,this._getNextDelay())})}_getNextProtocols(s){if(!s)return Promise.resolve(null);if(typeof s=="string"||Array.isArray(s))return Promise.resolve(s);if(typeof s=="function"){const n=s();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(s){if(typeof s=="string")return Promise.resolve(s);if(typeof s=="function"){const n=s();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:s=f.maxRetries,connectionTimeout:n=f.connectionTimeout}=this._options;if(this._retryCount>=s){this._debug("max retries reached",this._retryCount,">=",s);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,i])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!L&&(console.error(`‼️ No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),L=!0);const l=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:i}),this._ws=i?new l(r,i):new l(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new C.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new C.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(s=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(s,n),this._handleClose(new C.CloseEvent(s,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const se=e=>e[1]!==null&&e[1]!==void 0;function ne(){if(crypto!=null&&crypto.randomUUID)return crypto.randomUUID();let e=Date.now(),t=(performance==null?void 0:performance.now)&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let n=Math.random()*16;return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),(s==="x"?n:n&3|8).toString(16)})}function F(e,t,s={}){const{host:n,path:r,protocol:i,room:l,party:u,basePath:m,prefix:y,query:h}=e;let c=n.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),r!=null&&r.startsWith("/"))throw new Error("path must not start with a slash");const g=u??"main",b=r?`/${r}`:"",k=i||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:`${t}s`),I=`${k}://${c}/${m||`${y||"parties"}/${g}/${l}`}${b}`,w=(B={})=>`${I}?${new URLSearchParams([...Object.entries(s),...Object.entries(B).filter(se)])}`,R=typeof h=="function"?async()=>w(await h()):w(h);return{host:c,path:b,room:l,name:g,protocol:k,partyUrl:I,urlProvider:R}}var re=class extends te{constructor(t){var n,r;const s=x(t);super(s.urlProvider,s.protocols,s.socketOptions);d(this,"_pk");d(this,"_pkurl");d(this,"name");d(this,"room");d(this,"host");d(this,"path");this.partySocketOptions=t,this.setWSProperties(s),t.disableNameValidation||((n=t.party)!=null&&n.includes("/")&&console.warn(`PartySocket: party name "${t.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),(r=t.room)!=null&&r.includes("/")&&console.warn(`PartySocket: room name "${t.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(t){const s=x({...this.partySocketOptions,...t,host:t.host??this.host,room:t.room??this.room,path:t.path??this.path});this._url=s.urlProvider,this._protocols=s.protocols,this._options=s.socketOptions,this.setWSProperties(s)}setWSProperties(t){const{_pk:s,_pkurl:n,name:r,room:i,host:l,path:u}=t;this._pk=s,this._pkurl=n,this.name=r,this.room=i,this.host=l,this.path=u}reconnect(t,s){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(t,s)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(t,s){const n=F(t,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(t.fetch??fetch)(r,s)}};function x(e){const{id:t,host:s,path:n,party:r,room:i,protocol:l,query:u,protocols:m,...y}=e,h=t||ne(),c=F(e,"ws",{_pk:h});return{_pk:h,_pkurl:c.partyUrl,name:c.name,room:c.room,host:c.host,path:c.path,protocols:m,socketOptions:y,urlProvider:c.urlProvider}}const oe="thats-not-a-hat-server.kennyphan123.partykit.dev",o={socket:null,playerId:null,playerName:"",roomCode:"",isHost:!1,gameState:new j,dragHandler:null,discardHistory:[],hardMode:!1,slotCount:2},a={lobby:document.getElementById("lobby"),game:document.getElementById("game"),mainMenu:document.getElementById("mainMenu"),showCreate:document.getElementById("showCreate"),showJoin:document.getElementById("showJoin"),createForm:document.getElementById("createForm"),joinForm:document.getElementById("joinForm"),createName:document.getElementById("createName"),joinName:document.getElementById("joinName"),roomCode:document.getElementById("roomCode"),createRoom:document.getElementById("createRoom"),joinRoom:document.getElementById("joinRoom"),roomInfo:document.getElementById("roomInfo"),displayRoomCode:document.getElementById("displayRoomCode"),playerCount:document.getElementById("playerCount"),playerList:document.getElementById("playerList"),startGame:document.getElementById("startGame"),waitingText:document.querySelector(".waiting-text"),gameTable:document.getElementById("gameTable"),deck:document.getElementById("deck"),playersContainer:document.getElementById("playersContainer"),penaltyZone:document.getElementById("penaltyZone"),gameOverModal:document.getElementById("gameOverModal"),gameOverMessage:document.getElementById("gameOverMessage"),playAgain:document.getElementById("playAgain"),hardModeToggle:document.getElementById("hardModeToggle"),hardModeCheckbox:document.getElementById("hardModeCheckbox")};function ie(){ae(),me(),window.addEventListener("resize",()=>{o.gameState.gameStarted&&p()})}function ae(){var e,t,s,n;a.showCreate.addEventListener("click",()=>{a.mainMenu.classList.add("hidden"),a.createForm.classList.remove("hidden")}),a.showJoin.addEventListener("click",()=>{a.mainMenu.classList.add("hidden"),a.joinForm.classList.remove("hidden")}),a.createRoom.addEventListener("click",()=>{const r=a.createName.value.trim();if(!r){alert("Please enter your name");return}o.playerName=r,o.roomCode=q(4),o.isHost=!0,T()}),a.joinRoom.addEventListener("click",()=>{const r=a.joinName.value.trim(),i=a.roomCode.value.trim().toUpperCase();if(!r){alert("Please enter your name");return}if(!i||i.length!==4){alert("Please enter 4-letter room code");return}o.playerName=r,o.roomCode=i,o.isHost=!1,T()}),a.startGame.addEventListener("click",()=>{o.socket&&o.isHost&&o.socket.send(JSON.stringify({type:"start"}))}),(e=document.getElementById("backFromCreate"))==null||e.addEventListener("click",()=>{a.createForm.classList.add("hidden"),a.mainMenu.classList.remove("hidden")}),(t=document.getElementById("backFromJoin"))==null||t.addEventListener("click",()=>{a.joinForm.classList.add("hidden"),a.mainMenu.classList.remove("hidden")}),(s=document.getElementById("copyCodeBtn"))==null||s.addEventListener("click",le),(n=a.hardModeCheckbox)==null||n.addEventListener("change",r=>{o.socket&&o.isHost&&o.socket.send(JSON.stringify({type:"toggleHardMode",enabled:r.target.checked}))})}function le(){const e=a.displayRoomCode.textContent,t=document.getElementById("copyCodeBtn");navigator.clipboard.writeText(e).then(()=>{t.textContent="Copied!",setTimeout(()=>{t.textContent="Tap to Copy"},2e3)}).catch(()=>{const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),t.textContent="Copied!",setTimeout(()=>{t.textContent="Tap to Copy"},2e3)})}function T(){o.socket=new re({host:oe,room:o.roomCode}),o.socket.addEventListener("open",()=>{o.playerId=o.socket.id,o.socket.send(JSON.stringify({type:"join",name:o.playerName})),de(),o.pingInterval&&clearInterval(o.pingInterval),o.pingInterval=setInterval(()=>{o.socket&&o.socket.readyState===WebSocket.OPEN&&o.socket.send(JSON.stringify({type:"ping"}))},3e4)}),o.socket.addEventListener("message",e=>{ce(JSON.parse(e.data))}),o.socket.addEventListener("error",e=>{console.error("Connection error:",e)}),o.socket.addEventListener("close",()=>{o.pingInterval&&(clearInterval(o.pingInterval),o.pingInterval=null),o.gameState.gameStarted&&console.log("Connection lost, attempting to reconnect...")})}function de(){a.displayRoomCode.textContent=o.roomCode,a.roomInfo.classList.remove("hidden"),a.mainMenu.classList.add("hidden"),a.createForm.classList.add("hidden"),a.joinForm.classList.add("hidden")}function N(){const e=o.gameState.players;a.playerCount.textContent=e.length,a.playerList.innerHTML=e.map(t=>`<span class="player-tag${t.id===o.gameState.hostId?" host":""}">${t.name}${t.id===o.gameState.hostId?" (Host)":""}</span>`).join(""),o.isHost&&e.length>=2?(a.startGame.classList.remove("hidden"),a.hardModeToggle.classList.remove("hidden"),a.waitingText.classList.add("hidden")):o.isHost?a.hardModeToggle.classList.remove("hidden"):o.isHost||(a.waitingText.classList.remove("hidden"),a.hardModeToggle.classList.add("hidden"))}function ce(e){switch(console.log("Server:",e.type,e),e.type){case"state":o.gameState.players=e.state.players||[],o.gameState.deck=e.state.deck||[],o.gameState.hostId=e.state.hostId,o.gameState.gameStarted=e.state.gameStarted,e.state.gameStarted&&M();break;case"playerJoined":o.gameState.players=e.players,o.gameState.hostId=e.hostId,e.hostId===o.playerId&&(o.isHost=!0),N();break;case"playerLeft":o.gameState.players=e.players,e.hostId===o.playerId&&(o.isHost=!0),N(),o.gameState.gameStarted&&p();break;case"gameStarted":o.gameState.deck=e.deck,o.gameState.players=e.players,o.gameState.gameStarted=!0,o.hardMode=e.hardMode||!1,o.slotCount=e.slotCount||2,M();break;case"cardDrawn":ve(e);break;case"cardFlipped":Ee(e);break;case"cardMoved":o.gameState.players=e.players,p();break;case"cardsSwapped":Ce(e);break;case"cardDiscarded":be(e);break;case"gameReset":o.gameState.deck=e.deck,o.gameState.players=e.players,o.discardHistory=e.discardHistory||[],o.hardMode=e.hardMode||!1,o.slotCount=e.slotCount||2,a.gameOverModal.classList.add("hidden"),p();break;case"hardModeChanged":o.hardMode=e.hardMode,o.slotCount=e.slotCount,o.gameState.players=e.players,a.hardModeCheckbox&&(a.hardModeCheckbox.checked=e.hardMode);break;case"error":alert(e.message);break}}function M(){a.lobby.classList.remove("active"),a.game.classList.add("active"),o.gameState.currentPlayerId=o.playerId,he(),p()}function he(){o.dragHandler=new V({container:a.gameTable,onDrop:_e})}function p(){ue(),Q(o.gameState,a.playersContainer,{onFlip:fe,slotCount:o.slotCount})}function ue(){const e=a.deck,t=e.querySelector(".deck-cards"),s=e.querySelector(".deck-count");t.innerHTML="";const n=o.gameState.deck;if(n.length>0){const r=Math.min(n.length,5);for(let i=r-1;i>=0;i--){const l=document.createElement("div");l.className="deck-card";const u=n.length-1-i;n[u]&&(l.style.backgroundImage=`url(${n[u].front})`),l.style.top=`${-i*2}px`,l.style.left=`${i*1}px`,l.style.zIndex=r-i,t.appendChild(l)}}s.textContent=n.length,e.onclick=()=>{o.socket&&n.length>0&&o.socket.send(JSON.stringify({type:"draw"}))},e.style.display=n.length>0?"":"none"}function me(){var t;(t=a.playAgain)==null||t.addEventListener("click",()=>{o.socket&&o.socket.send(JSON.stringify({type:"reset"}))}),ge();const e=document.getElementById("fullscreenBtn");e==null||e.addEventListener("click",pe)}function pe(){if(!document.fullscreenElement&&!document.webkitFullscreenElement){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}else document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function ge(){a.penaltyZone.addEventListener("click",e=>{e.target.closest(".card")||ye()})}function ye(){let e=document.getElementById("discardHistoryModal");if(e){e.classList.toggle("hidden"),e.classList.contains("hidden")||P();return}e=document.createElement("div"),e.id="discardHistoryModal",e.className="modal",e.innerHTML=`
        <div class="modal-content discard-history-modal">
            <h2>Discard History</h2>
            <div id="discardHistoryList" class="discard-history-list"></div>
            <button id="closeDiscardHistory" class="btn btn-secondary">Close</button>
        </div>
    `,document.body.appendChild(e),document.getElementById("closeDiscardHistory").addEventListener("click",()=>{e.classList.add("hidden")}),e.addEventListener("click",t=>{t.target===e&&e.classList.add("hidden")}),P()}function P(){const e=document.getElementById("discardHistoryList");if(e){if(o.discardHistory.length===0){e.innerHTML='<p class="no-discards">No cards discarded yet</p>';return}e.innerHTML=o.discardHistory.map((t,s)=>`
        <div class="discard-item">
            <div class="discard-card" style="background-image: url(${t.card.front})"></div>
            <span class="discard-player">${t.playerName}</span>
        </div>
    `).join("")}}function fe(e,t){e===o.playerId&&o.socket&&o.socket.send(JSON.stringify({type:"flip",slotIndex:t}))}function _e(e,t){!e||!t||(t.type==="penalty"?e.fromPlayerId===o.playerId&&o.socket&&o.socket.send(JSON.stringify({type:"discard",playerId:e.fromPlayerId,slotIndex:e.fromSlot})):t.type==="player"&&(t.playerId===e.fromPlayerId?e.fromSlot!==t.slotIndex&&o.socket&&o.socket.send(JSON.stringify({type:"swapCards",playerId:e.fromPlayerId})):t.playerId===o.playerId&&t.isEmpty?o.socket&&o.socket.send(JSON.stringify({type:"moveCard",fromPlayerId:e.fromPlayerId,fromSlot:e.fromSlot,toPlayerId:t.playerId,toSlot:t.slotIndex})):e.fromPlayerId===o.playerId&&t.isEmpty&&o.socket&&o.socket.send(JSON.stringify({type:"moveCard",fromPlayerId:e.fromPlayerId,fromSlot:e.fromSlot,toPlayerId:t.playerId,toSlot:t.slotIndex}))))}function ve(e){o.gameState.deck.pop(),e.players&&(o.gameState.players=e.players),p()}function Ee(e){const t=o.gameState.players.find(s=>s.id===e.playerId);t&&t.cards[e.slotIndex]&&(t.cards[e.slotIndex].isFlipped=e.isFlipped),p()}function Ce(e){const t=o.gameState.players.find(s=>s.id===e.playerId);t&&(t.cards=e.cards),p()}function be(e){e.players&&(o.gameState.players=e.players),e.discardHistory&&(o.discardHistory=e.discardHistory),p(),e.gameOver&&ke(e.loserName)}function ke(e){a.gameOverMessage.textContent=`${e} got 3 penalties and lost!`,a.gameOverModal.classList.remove("hidden")}ie();
